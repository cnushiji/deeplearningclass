import streamlit as st
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

tab1, tab2, tab3, tab4, tab5, tab6 = st.tabs(['1.ç½‘ç»œæ¶æ„', '2.ä¼˜åŒ–', '3.åå‘ä¼ æ’­(BP)', '4.åˆå§‹åŒ–','5.æ­£åˆ™åŒ–','6.ç¤ºä¾‹â€”â€”mnist'])

with tab1:
    """- äººå·¥ç¥ç»å…ƒæ¨¡å‹ï¼š"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡10.png', caption='å›¾10')
    """- æ¿€æ´»å‡½æ•°ï¼š"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡11.png', caption='å›¾11')
    """- MLPï¼š"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡12.png', caption='å›¾12')
    """- ä¸‡æœ‰é€¼è¿‘å®šç†ï¼š"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡13.png', caption='å›¾13')
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡14.png', caption='å›¾14')

with tab2:
    """- ä¼˜åŒ–çš„åŸå› ï¼š"""
    r"""$ \qquad $ äººå·¥æ™ºèƒ½çš„è¯¸å¤šåº”ç”¨éœ€è¦ç”¨å¤§é‡æ•°æ®è¿›è¡Œå­¦ä¹ ã€‚é€šè¿‡å­¦ä¹ ï¼Œç¥ç»ç½‘ç»œå¯ä»¥è‡ªåŠ¨åœ°ä»æ•°æ®ä¸­æå–ç‰¹å¾ï¼Œå¹¶æ ¹æ®å­¦ä¹ çš„ç‰¹å¾è‡ªåŠ¨å†³ç­–ã€‚"""
    r"""$ \qquad $ å­¦ä¹ (learning)åœ¨æ•°å­¦ä¸Šè¡¨è¾¾ä¸ºå¯¹ä¸€ä¸ªæŸå¤±å‡½æ•°ğ¿(ğ‘¥,ğœƒ)çš„ä¼˜åŒ–é—®é¢˜ã€‚"""
    r"""$ \qquad $ ä¸ºäº†æ±‚è§£æ­¤ä¼˜åŒ–é—®é¢˜ï¼Œä¸€ç±»é‡è¦çš„ä¼˜åŒ–æ–¹æ³•æ˜¯åŸºäºæ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–ç®—æ³•ã€‚"""
    """- ä¼˜åŒ–çš„å®šä¹‰ï¼š"""
    r"""$ \qquad $ æ•°å­¦ä¸­çš„ä¼˜åŒ–ï¼šé€šè¿‡æ”¹å˜è‡ªå˜é‡xä»¥æœ€å°åŒ–æˆ–æœ€å¤§åŒ–å‡½æ•°ğ‘“(ğ‘¥)ï¼Œğ‘“(ğ‘¥)ç§°ä¸ºç›®æ ‡å‡½æ•°æˆ–è€…æŸå¤±å‡½æ•°ã€‚"""
    r"""$ \qquad $ äººå·¥æ™ºèƒ½ç®—æ³•ä¸­çš„ä¼˜åŒ–ï¼šè®­ç»ƒæ•°æ®é›†Xï¼Œæ ·æœ¬æ ‡ç­¾Yï¼Œç¥ç»ç½‘ç»œè¾“å‡ºğ‘“(ğ‘¥,ğœƒ),ğ‘(ğ‘¥,ğ‘¦)æ˜¯è”åˆåˆ†å¸ƒï¼Œå› æ­¤æŸå¤±å‡½æ•°å®šä¹‰ä¸º"""
    st.latex(r"""L(\theta)=\frac{1}{m}\sum_i{l(f(x^{(i)},\theta),y^{(i)})}""")
    r"""$ \qquad \qquad $ å…¶ä¸­ï¼Œğ‘™æ˜¯æ¯ä¸ªæ ·æœ¬çš„æŸå¤±å‡½æ•°ã€‚ä¼˜åŒ–çš„ç›®æ ‡æ˜¯æ‰¾åˆ°æœ€ä¼˜çš„å‚æ•°$ \theta_âˆ— $ä½¿å¾—æŸå¤±å‡½æ•°Lå–å¾—æœ€å°å€¼ã€‚"""

    """- æ¢¯åº¦ä¸‹é™ï¼š"""
    r"""$ \qquad $ æ¢¯åº¦ï¼š"""
    st.latex(r"""\nabla{f(x)}=[\frac{\partial{f}}{\partial{x_1}},...,\frac{\partial{f}}{\partial{x_n}}]^T""")
    r"""$\qquad \qquad $ å‡ ä½•å«ä¹‰ï¼š$\nabla{f(x)}$å‡½æ•°å¢é•¿æœ€å¿«çš„æ–¹å‘ã€‚"""
    r"""$\qquad \qquad $ ç›´è§‚å¯å‘ï¼šåœ¨è´Ÿæ¢¯åº¦æ–¹å‘ä¸Šå‡½æ•°å€¼ä¸‹é™æœ€å¿«ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æ¯æ¬¡æ²¿ç€è´Ÿæ¢¯åº¦æ–¹å‘ç§»åŠ¨$ \theta $ï¼Œé‚£ä¹ˆå‡½æ•°å€¼å°±ä¼šä¸æ–­ä¸‹é™ã€‚"""
    _, col1, _ = st.columns([2, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡15.png', caption='å›¾15')

    r"""$ \qquad $ å…¬å¼ï¼š"""
    st.latex(r"""\theta_{n+1}=\theta_n-\alpha{\frac{1}{m}\sum_i{\nabla_{\theta_n}{l(x^{(i)},\theta_n)}}}""")
    r"""$ \qquad \qquad $ å…¶ä¸­$ \alpha $æ˜¯å­¦ä¹ ç‡ï¼Œè¡¨ç¤ºæ¯ä¸€æ­¥æ›´æ–°çš„æ­¥é•¿ã€‚"""
    r"""$ \qquad $ ç¤ºä¾‹ï¼šåœ¨[âˆ’1,1]ä¸Šå‡åŒ€é‡‡æ ·çš„mä¸ªæ ·æœ¬æ•°æ®ï¼Œé€šè¿‡ä¸€ä¸ªéšè—å±‚çš„ç¥ç»ç½‘ç»œå­¦ä¹ å‡½æ•°$ y=0.5ğ‘¥^2 $ã€‚ æŸå¤±å‡½æ•°å®šä¹‰å¦‚ä¸‹"""
    st.latex(r"""min{L(x,\theta)}=\frac{1}{m}\sum_i{(f(x^{(i)},\theta),y^{(i)})^2}""")
    r"""$ \qquad $ ä¼˜åŒ–ç»“æœï¼š"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡16.jpg', caption='å›¾16')

    """- æ·±åº¦å­¦ä¹ ä¸­çš„ä¼˜åŒ–æ–¹æ³•ï¼š"""
    r"""$ \qquad $ 1.éšæœºæ¢¯åº¦ä¸‹é™â€”â€”Vanilla-SGDï¼š"""
    r"""$ \qquad \qquad $ é—®é¢˜ï¼šæ•°æ®é›†æœ‰å‡ åä¸Šç™¾ä¸‡æ¡æ•°æ®æ—¶ï¼Œç”¨æ•´ä¸ªæ•°æ®é›†è®­ç»ƒï¼Œè®¡ç®—ä»£ä»·é«˜ï¼Œæ‰€éœ€è®¡ç®—å†…å­˜å¤§ã€‚"""
    r"""$ \qquad \qquad $ å¦‚ä½•è§£å†³? â†’ éšæœºæ¢¯åº¦ä¼˜åŒ–(SGD)ï¼šæ¯ä¸€æ¬¡æ›´æ–°å‚æ•°æ—¶åªç”¨ä¸€ä¸ªæ ·æœ¬ï¼Œä»è€Œä½¿å¾—è®¡ç®—å¯è¡Œã€‚â€œä»¥æ—¶é—´æ¢èµ„æºâ€"""
    r"""$ \qquad \qquad $ å…¬å¼ï¼š"""
    st.latex(r"""\theta_{n+1}=\theta_n-\alpha{\cdot{\nabla_{\theta_n}l(x^{(i)},\theta_n)}}""")
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡17.png', caption='å›¾17')
    r"""$ \qquad \qquad $ """
    r"""$ \qquad $ 2.éšæœºæ¢¯åº¦ä¸‹é™â€”â€”minibatch-SGDï¼š"""
    r"""$ \qquad \qquad $ é—®é¢˜ï¼šåŸå§‹SGDæ–¹æ³•æ”¶æ•›é€Ÿåº¦æ…¢ï¼Œè®­ç»ƒä¸ç¨³å®šã€‚"""
    r"""$ \qquad \qquad $ å¦‚ä½•æ”¹è¿›ï¼Ÿâ†’ minibatch SGD: åœ¨æ¯ä¸€æ¬¡æ›´æ–°å‚æ•°æ—¶ç”¨ä¸€ç»„æ ·æœ¬ï¼Œè€Œä¸æ˜¯åªç”¨ä¸€ä¸ªæ ·æœ¬ã€‚"""
    r"""$ \qquad \qquad $ å…¬å¼ï¼š"""
    st.latex(r"""g_n=\frac{1}{|B|}\sum_{i\in{B}}{\nabla_{\theta_n}l(x^{(i)},\theta_n)},\theta_{n+1}=\theta_n-\alpha{\cdot{g_n}}""")
    r"""$ \qquad \qquad \qquad $ å…¶ä¸­ï¼ŒBæ˜¯ä¸€ä¸ªminibatchï¼Œ$|ğµ|$è¡¨ç¤ºminibatchçš„å¤§å°ã€‚"""
    r"""$ \qquad $ 3.åŠ¨é‡æ–¹æ³•â€”â€”Momentum-SGDï¼š"""
    r"""$ \qquad \qquad $ åŠ¨é‡æ–¹æ³•(Momentum-SGD)æ˜¯åˆ©ç”¨å†å²æ¢¯åº¦ä¿¡æ¯å’Œå½“å‰æ¢¯åº¦ä¿¡æ¯ç»™å‡ºå½“æ¢¯åº¦ä¸‹é™æ–¹å‘ï¼ŒåŠ é€ŸSGDåœ¨æ­£ç¡®æ–¹å‘çš„ä¸‹é™å¹¶æŠ‘åˆ¶éœ‡è¡ã€‚"""
    r"""$ \qquad \qquad $ å…¬å¼ï¼š"""
    st.latex(r"""g_t=\frac{1}{|B|}\sum_{i\in{B}}{\nabla_{\theta_t}l(x^{(i)},\theta_t)}""")
    st.latex(r"""m_t=\gamma{m_{t-1}}+(1-\gamma)g_t""")
    st.latex(r"""\theta_{t+1}=\theta_t-m_t""")
    col1, col2 = st.columns([1,1.1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡18.png', caption='å›¾18 SGD')
    with col2:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡19.png', caption='å›¾19 Momentum')
    r"""$ \qquad $ 4.NestrovåŠ é€Ÿæ¢¯åº¦(NAG)ï¼š"""
    r"""$ \qquad \qquad $ ç›´è§‚æƒ³æ³•ï¼šåœ¨ç›®æ ‡å‡½æ•°æœ‰å¢é«˜è¶‹åŠ¿ä¹‹å‰ï¼Œå‡ç¼“æ›´æ–°é€Ÿç‡ã€‚"""
    r"""$ \qquad \qquad $ NAGåŸç†ï¼šè®¡ç®—æœªæ¥ä½ç½®çš„æ¢¯åº¦ï¼Œå¹¶ç»“åˆå†å²æ¢¯åº¦ä¿¡æ¯å¾—åˆ°ä¸‹é™æ–¹å‘ã€‚"""
    r"""$ \qquad \qquad $ å…¬å¼ï¼š"""
    st.latex(r""" g_t=\frac{1}{|B|}\sum_{i\in{B}}{\nabla_{\theta_t}l(x^{(i)},\theta_t-\gamma{m_{t-1}})} """)
    st.latex(r"""m_t=\gamma{m_{t-1}}+(1-\gamma)g_t""")
    st.latex(r"""\theta_{t+1}=\theta_t-m_t""")
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡20.png', caption='å›¾20')
    r"""$ \qquad \qquad $ """
    r"""$ \qquad $ 5.è‡ªé€‚åº”å­¦ä¹ ç‡æ–¹æ³•(AdaGrad/RMSProp)"""
    r"""$ \qquad \qquad $ è‡ªé€‚åº”è°ƒæ•´å­¦ä¹ ç‡ï¼šéšç€ä¼˜åŒ–çš„è¿›è¡Œï¼Œå‚æ•°æ¢¯åº¦çš„å˜åŒ–è¶Šæ¥è¶Šå°ï¼Œè€Œä¸€ç›´ç”¨å›ºå®šçš„å­¦ä¹ ç‡æ˜¯å¦åˆé€‚ï¼Ÿ"""
    r"""$ \qquad \qquad $ AdaGradï¼šéšç€å­¦ä¹ è¿‡ç¨‹çš„è¿›è¡Œï¼ŒåŠ¨æ€è°ƒæ•´å­¦ä¹ ç‡ã€‚"""
    r"""$ \qquad \qquad \qquad $ å…¬å¼ï¼š"""
    st.latex(r"""V_t=\sum_{i=1}^t{g_i^2}, \qquad \theta_{t+1}=\theta_t-\eta{\cdot{\frac{1}{\sqrt{V_t+\varepsilon}}g_t}}""")
    r"""$ \qquad \qquad $ RMSPropï¼šä¿®æ”¹AdaGradçš„æ¢¯åº¦å¹³æ–¹å’Œç´¯åŠ ä¸ºæŒ‡æ•°åŠ æƒçš„ç§»åŠ¨å¹³å‡ã€‚"""
    r"""$ \qquad \qquad \qquad $ å…¬å¼ï¼š"""
    st.latex(r"""g_t=\nabla_{\theta_t}{L(B,\theta_t)}""")
    st.latex(r"""E[g_t^2]_t=\beta{E[g_t^2]_{t-1}}+(1-\beta)g_t^2""")
    st.latex(r"""\theta_{t+1}=\theta_t-\eta{\frac{1}{\sqrt{E[g_t^2]_t+\varepsilon}}g_t}""")
    r"""$ \qquad $ 6.Adamä¼˜åŒ–æ–¹æ³•ï¼š"""
    r"""$ \qquad \qquad $ ç»“åˆä¸€é˜¶åŠ¨é‡å’ŒäºŒé˜¶åŠ¨é‡ä¿¡æ¯ã€‚"""
    r"""$ \qquad \qquad $ ç›´è§‚ç†è§£ï¼šâ€œMomentumæ–¹æ³• + RMSPropæ–¹æ³•â€"""
    r"""$ \qquad \qquad $ å…¬å¼ï¼š"""
    st.latex(r"""g_t=\nabla_{\theta_t}{L(B,\theta_t)}""")
    st.latex(r"""m_t=\beta_1{m_{t-1}}+(1-\beta_1)g_t, \qquad \hat{m}_t=\frac{\hat{m}_t}{1-\beta_1^t}""")
    st.latex(r"""v_t=E[g_t^2]_t=\beta_2E[g_t^2]_{t-1}+(1-\beta_2)g_t^2, \qquad \hat{v}_t=\frac{\hat{v}_t}{1-\beta_2^t}""")
    st.latex(r"""\theta_{t+1}=\theta_t-\eta{\cdot{\frac{\hat{m}_t}{\sqrt{\hat{v}_t+\varepsilon}}}}""")
    r"""$ \qquad \qquad $ åšäº†ä¸€ä¸ªåç½®æ ¡æ­£bias correctionï¼Œé˜²æ­¢åœ¨è®­ç»ƒåˆå§‹é˜¶æ®µè¿‡äºåå‘0ã€‚"""

    r"""$ \qquad $ ä¸åŒä¼˜åŒ–æ–¹æ³•çš„æ¯”è¾ƒç¤ºä¾‹ï¼š"""
    r"""$ \qquad \qquad $ ç¤ºä¾‹ï¼Œå­¦ä¹ ä¸€ä¸ªå®šä¹‰åœ¨[-1,1]ä¸Šçš„ä¸€ç»´å‡½æ•°$ğ‘¦=0.5ğ‘¥^2$ã€‚"""
    col1, col2= st.columns([1,1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡21.gif', caption='å›¾21')
    with col2:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡22.gif', caption='å›¾22')
    _, col1, _= st.columns([1, 1.2, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡23.gif', caption='å›¾23')
    r"""$ \qquad $ æ€»ç»“ï¼š"""
    r"""$ \qquad \qquad $ 1.å›å¿†ä¸€ä¸‹è¦ç‚¹ï¼šæŸå¤±å‡½æ•°+æ¢¯åº¦ä¸‹é™ï¼Œå³åˆ©ç”¨å½“å‰æ¢¯åº¦ï¼Œå†å²æ¢¯åº¦ï¼Œä¸‹ä¸€æ­¥æ¢¯åº¦çš„ä¸åŒç»“åˆç­–ç•¥å½¢æˆäº†ä¸åŒçš„ä¼˜åŒ–æ–¹æ³•æ–¹æ³•ã€‚"""
    r"""$ \qquad \qquad $ 2.å“ªç§ä¼˜åŒ–æ–¹æ³•æœ€å¥½ï¼Ÿæ²¡æœ‰ä¸€ç§ä¼˜åŒ–æ–¹æ³•å¯¹æ‰€æœ‰çš„é—®é¢˜éƒ½æ˜¯æœ€å¥½çš„ï¼Œé€šå¸¸æ¨èAdamæ–¹æ³•ã€‚"""
    r"""$ \qquad \qquad $ 3.æ¢¯åº¦å¦‚ä½•è®¡ç®—ï¼Ÿâ†’åå‘ä¼ æ’­ç®—æ³•BP"""

with tab3:
    """- å¾®ç§¯åˆ†ä¸­çš„é“¾å¼æ³•åˆ™ï¼š"""
    r"""$ \qquad $ å¾®ç§¯åˆ†ä¸­çš„é“¾å¼æ³•åˆ™ç”¨äºè®¡ç®—å¤åˆå‡½æ•°çš„å¯¼æ•°ã€‚åå‘ä¼ æ’­æ˜¯ä¸€ç§è®¡ç®—é“¾å¼æ³•åˆ™çš„ç®—æ³•ï¼Œä½¿ç”¨é«˜æ•ˆçš„ç‰¹å®šè¿ç®—é¡ºåºã€‚"""
    r"""$ \qquad $ å‡è®¾$x\in{R^m},y\in{R^n}$,ğ‘”æ˜¯ä»$ğ‘…^ğ‘š$åˆ°$ğ‘…^ğ‘›$çš„æ˜ å°„ï¼Œğ‘“æ˜¯ä»$ğ‘…^ğ‘›$åˆ°ğ‘…çš„æ˜ å°„ã€‚å¦‚æœ$ğ‘¦=ğ‘”(ğ‘¥)$å¹¶ä¸”$ğ‘§=ğ‘“(ğ‘¦)$ï¼Œé‚£ä¹ˆ"""
    st.latex(r"""\nabla_x{z}=(\frac{\partial{y}}{\partial{x}})^T\nabla_y{z}""")
    r"""$ \qquad $ è¿™é‡Œ$\frac{\partial{y}}{\partial{x}}$æ˜¯gçš„$n\times{m}$çš„JacobiançŸ©é˜µã€‚"""
    r"""$ \qquad $ å¼ é‡çš„é“¾å¼æ³•åˆ™ï¼šå¦‚æœ$ğ’€=ğ‘”(ğ‘¿)$å¹¶ä¸”$ğ‘§=ğ‘“(ğ’€)$ï¼Œé‚£ä¹ˆ"""
    st.latex(r"""\nabla_x{z}=\sum_j{(\nabla_X{Y_j})\frac{\partial{z}}{\partial{Y_j}}}""")
    """- é€’å½’åœ°ä½¿ç”¨é“¾å¼æ³•åˆ™åå‘ä¼ æ’­ï¼š"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡24.png', caption='å›¾24')
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡25.png', caption='å›¾25')
    r"""$ \qquad $ å‰å‘è¿‡ç¨‹ï¼š"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡26.png', caption='å›¾26')
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡27.png', caption='å›¾27')
    _, col1, _ = st.columns([1, 4, 1])
    r"""$ \qquad $ åå‘è¿‡ç¨‹ï¼š"""
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡28.png', caption='å›¾28')
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡29.png', caption='å›¾29')
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡30.png', caption='å›¾30')
    r"""$ \qquad \qquad $ ä¸Šå›¾ä¸­ï¼Œ$\sigma'{(z)}$æ˜¯å¸¸æ•°ï¼Œå› ä¸ºzåœ¨Forward Passçš„æ—¶å€™å°±å·²ç»è¢«ç¡®å®šäº†ã€‚"""
    r"""$ \qquad $ æœ€åçš„é—®é¢˜åªæœ‰å¦‚ä½•è®¡ç®—$ \frac{\partial{C}}{\partial{z'}},\frac{\partial{C}}{\partial{z"}} $ï¼Œå¦‚ä¸‹å›¾ï¼š"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡31.png', caption='å›¾31')
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡32.png', caption='å›¾32')
    r"""$ \qquad $ ä»output layerè®¡ç®—$ \frac{\partial{C}}{\partial{z}} $ï¼Œå¦‚ä¸‹å›¾ï¼š"""
    st.latex(r"""\frac{\partial{C}}{\partial{z_3}}=\sigma'{z_3}[w_5\frac{\partial{C}}{\partial{z_5}}+w_6\frac{\partial{C}}{\partial{z_6}}]""")
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡33.png', caption='å›¾33')
    r"""$ \qquad $ æ€»ç»“ï¼š"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡34.png', caption='å›¾34')

    """- æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸ï¼š"""
    r"""$ \qquad $ Vanishing gradient problem: ç”±äºSigmoidå‹å‡½æ•°çš„é¥±å’Œæ€§ï¼Œé¥±å’ŒåŒºçš„å¯¼æ•°æ›´æ˜¯æ¥è¿‘äº0ã€‚è¿™æ ·ï¼Œè¯¯å·®ç»è¿‡æ¯ä¸€å±‚ä¼ é€’éƒ½ä¼šä¸æ–­è¡°å‡ï¼å½“ç½‘ç»œå±‚æ•°å¾ˆæ·±æ—¶ï¼Œæ¢¯åº¦å°±ä¼šä¸åœè¡°å‡ï¼Œç”šè‡³æ¶ˆå¤±ï¼Œä½¿å¾—æ•´ä¸ªç½‘ç»œå¾ˆéš¾è®­ç»ƒï¼è¿™å°±æ˜¯æ‰€è°“çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼ˆVanishing Gradient Problemï¼‰ï¼Œä¹Ÿç§°ä¸ºæ¢¯åº¦å¼¥æ•£é—®é¢˜ã€‚"""
    r"""$ \qquad $ Gradient exploding problem: å½“æ·±å±‚ç¥ç»ç½‘ç»œæˆ–å¾ªç¯å·ç§¯ç¥ç»ç½‘ç»œä¸­ç½‘ç»œæƒå€¼åˆå§‹åŒ–å€¼å¤ªå¤§æ—¶ï¼Œéšç€ç½‘ç»œæ·±åº¦çš„åŠ æ·±ï¼Œæ¢¯åº¦ä¸­çš„é‡å¤ç›¸ä¹˜é¡¹ä¼šå¯¼è‡´æ¢¯åº¦å‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œæ¢¯åº¦å˜çš„éå¸¸å¤§ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œæƒå€¼çš„å¤§å¹…æ›´æ–°ï¼Œå¹¶å› æ­¤å¯¼è‡´ç½‘ç»œçš„ä¸ç¨³å®šã€‚"""
    r"""$ \qquad $ å¦‚ä½•è§£å†³ï¼Ÿæ¢¯åº¦å‰ªåˆ‡ã€ReLUæ¿€æ´»ã€æ­£åˆ™åŒ–ã€BNã€æ®‹å·®è¿æ¥ç­‰ã€‚"""

    """- åœ¨pytorchä¸­å¦‚ä½•è®¡ç®—å¯¼æ•°ï¼Ÿ"""
    r"""$ \qquad $ Pytorchçš„åå‘ä¼ æ’­æ—¶è®¡ç®—æ¢¯åº¦é»˜è®¤é‡‡ç”¨ç´¯åŠ æœºåˆ¶ï¼Œå³å½“æœªæ‰‹åŠ¨å¯¹ä¸Šä¸€æ¬¡è®¡ç®—çš„æ¢¯åº¦è¿›è¡Œæ¸…é›¶æ—¶ï¼Œå½“å‰æ¢¯åº¦å€¼æ˜¯æœ¬æ¬¡æ¢¯åº¦å€¼åŠ ä¸Šä¸Šä¸€æ¬¡çš„æ¢¯åº¦å€¼ã€‚"""
    st.code(r"""Optimizer.zero_grad() æˆ–
w.grad.data.zero_() æˆ–
b.grad.data.zero_()
    """)
    r"""$ \qquad $ åå‘ä¼ æ’­çš„ä¸­é—´ç¼“å­˜ä¼šè¢«æ¸…ç©ºï¼Œå¦‚æœéœ€è¦è¿›è¡Œå¤šæ¬¡åå‘ä¼ æ’­ï¼Œéœ€è¦åˆ¶å®šbackwardä¸­çš„å‚æ•°"""
    st.code(r"""retain_graph=True""")
    r"""$ \qquad $ è¿™åœ¨å¯¹éæ ‡é‡å‡½æ•°æ±‚å¯¼æ—¶æœ‰ç”¨ã€‚"""
    r"""$ \qquad $ è®¡ç®—å›¾ï¼š"""
    r"""$ \qquad \qquad $ ä¸ºäº†æ›´ç²¾ç¡®åœ°æè¿°åå‘ä¼ æ’­ç®—æ³•ï¼Œä½¿ç”¨æ›´ç²¾ç¡®çš„è®¡ç®—å›¾(computational graph)è¯­è¨€æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚è®¡ç®—å›¾æ˜¯æ•°å­¦è¿ç®—çš„å›¾å½¢åŒ–è¡¨ç¤ºã€‚"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡35.png', caption='å›¾35')
    r"""$ \qquad \qquad $ å›¾ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æ¥è¡¨ç¤ºä¸€ä¸ªå˜é‡ã€‚å˜é‡å¯ä»¥æ˜¯æ ‡é‡ã€å‘é‡ã€çŸ©é˜µã€å¼ é‡æˆ–è€…ç”šè‡³æ˜¯å¦ä¸€ç±»å‹çš„å˜é‡ã€‚è¾¹è¡¨ç¤ºè¿ç®—æˆ–æ“ä½œoperationã€‚"""
    r"""$ \qquad \qquad $ è®¡ç®—å›¾ä¸­æ¯ä¸ªå¶å­èŠ‚ç‚¹ä¸ºä¸€ä¸ªè¾“å…¥å˜é‡æˆ–å¸¸é‡ã€‚æ¯ä¸ªéå¶å­èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªä¸­é—´å˜é‡ï¼Œæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡çš„ç®€å•å‡½æ•°ã€‚"""
    r"""$ \qquad \qquad $ æ ¹æ®è®¡ç®—å›¾æ­å»ºæ–¹å¼çš„ä¸åŒï¼Œå¯å°†è®¡ç®—å›¾åˆ†ä¸ºé™æ€å›¾å’ŒåŠ¨æ€å›¾ã€‚"""
    r"""$ \qquad $ è‡ªåŠ¨å¾®åˆ†Auto-differentiationï¼š"""
    r"""$ \qquad \qquad $ å‰å‘æ¨¡å¼ï¼š æŒ‰è®¡ç®—å›¾ä¸­è®¡ç®—æ–¹å‘çš„ç›¸åŒæ–¹å‘æ¥é€’å½’åœ°è®¡ç®—æ¢¯åº¦ã€‚"""
    r"""$ \qquad \qquad $ åå‘æ¨¡å¼ï¼šæŒ‰è®¡ç®—å›¾ä¸­è®¡ç®—æ–¹å‘çš„ç›¸åæ–¹å‘æ¥é€’å½’åœ°è®¡ç®—æ¢¯åº¦ã€‚"""
    r"""$ \qquad \qquad $ æ— è®ºæ˜¯å‰å‘æ¨¡å¼è¿˜æ˜¯åå‘æ¨¡å¼ï¼ŒäºŒè€…è®¡ç®—æ¢¯åº¦çš„æ–¹å¼éƒ½ç›¸åŒã€‚åœ¨å‰é¦ˆç¥ç»ç½‘ç»œçš„å‚æ•°å­¦ä¹ ä¸­ï¼Œé£é™©å‡½æ•°$ğ‘“:ğ‘…^ğ‘â†’ğ‘…$ï¼Œè¾“å‡ºä¸ºæ ‡é‡ï¼Œå› æ­¤é‡‡ç”¨åå‘æ¨¡å¼æ˜¯æœ€æœ‰æ•ˆçš„è®¡ç®—æ–¹å¼ã€‚"""
    r"""$ \qquad $ é™æ€è®¡ç®—å›¾å’ŒåŠ¨æ€è®¡ç®—å›¾ï¼š"""
    r"""$ \qquad \qquad $ é™æ€è®¡ç®—å›¾æ˜¯åœ¨ç¼–è¯‘æ—¶æ„å»ºè®¡ç®—å›¾ï¼Œè®¡ç®—å›¾æ„å»ºå¥½ä¹‹ååœ¨ç¨‹åºè¿è¡Œæ—¶ä¸èƒ½æ”¹å˜ã€‚è€ŒåŠ¨æ€è®¡ç®—å›¾æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€æ„å»ºã€‚"""
    r"""$ \qquad \qquad $ ç›®å‰ä¸»æµçš„æ·±åº¦å­¦ä¹ æ¡†æ¶é‡Œï¼ŒTheanoå’ŒTensorflow1.xç‰ˆæœ¬é‡‡ç”¨çš„æ˜¯é™æ€è®¡ç®—å›¾ï¼Œè€ŒPytorché‡‡ç”¨çš„æ˜¯åŠ¨æ€è®¡ç®—å›¾ã€‚Tensorflow2.0ä¹Ÿæ”¯æŒåŠ¨æ€è®¡ç®—å›¾ã€‚"""
    r"""$ \qquad \qquad $ é™æ€è®¡ç®—å›¾å¯ä»¥åœ¨æ„å»ºæ—¶è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è¡Œèƒ½åŠ›å¼ºï¼Œä½†çµæ´»æ€§æ¯”è¾ƒå·®ã€‚åŠ¨æ€è®¡ç®—å›¾ä¸å®¹æ˜“ä¼˜åŒ–ï¼Œå½“ä¸åŒè¾“å…¥çš„ç½‘ç»œç»“æ„ä¸ä¸€è‡´æ—¶ï¼Œéš¾ä»¥å¹¶è¡Œè®¡ç®—ï¼Œçµæ´»æ€§æ¯”è¾ƒé«˜ã€‚ï¼ˆçˆ¬æ¢¯åº¦ï¼Œè¾¹çˆ¬è¾¹æ­ï¼Œå’Œè¾¹æ­è¾¹çˆ¬ï¼‰"""

with tab4:
    """- ä¸ºä»€ä¹ˆè¿›è¡Œåˆå§‹åŒ–ï¼Ÿ"""
    r"""$ \qquad $ æƒé‡åˆå§‹åŒ–æ˜¯èµ‹ç»™ç½‘ç»œä¸€ä¸ªå¥½çš„åˆå€¼ï¼Œç›®çš„æ˜¯åœ¨é€šè¿‡æ·±å±‚ç¥ç»ç½‘ç»œçš„å‰é¦ˆè·¯å¾„ä¸­ï¼Œé˜²æ­¢å±‚æ¿€æ´»è¾“å‡ºçˆ†ç‚¸æˆ–è€…æ¶ˆå¤±ã€‚"""
    """- Xavieråˆå§‹åŒ–ï¼š"""
    r"""$ \qquad $ 2010è®ºæ–‡ã€ŠUnderstanding the difficulty of training deep feedforward neural networksã€‹"""
    r"""$ \qquad $ Motivationï¼šä¸ºäº†ä½¿å¾—ç½‘ç»œä¸­ä¿¡æ¯æ›´å¥½çš„æµåŠ¨ï¼Œæ¯ä¸€å±‚è¾“å‡ºçš„æ–¹å·®åº”è¯¥å°½é‡ç›¸ç­‰ã€‚"""
    r"""$ \qquad $ 1.å‡åŒ€åˆ†å¸ƒï¼š"""
    r"""$ \qquad \qquad $ ç”¨æ³•ï¼š """
    st.code("""torch.nn.init.xavier_uniform_(tensor,gain=1)""")
    r"""$ \qquad \qquad $ Xavieråˆå§‹åŒ–æ–¹æ³•ä¸­æœä»å‡åŒ€åˆ†å¸ƒU(-a,a),åˆ†å¸ƒçš„å‚æ•°å¦‚ä¸‹ï¼Œ"""
    st.code("""a=gain*sqrt(6/fan_in+fan_out)""")
    r"""$\qquad \qquad $ è¿™é‡Œæœ‰ä¸€ä¸ªgain, å¢ç›Šçš„å¤§å°æ˜¯ä¾æ®æ¿€æ´»å‡½æ•°ç±»å‹æ¥è®¾å®šã€‚"""
    r"""$ \qquad \qquad $ ä¾‹å¦‚ï¼Œ"""
    st.code("""nn.init.xavier_uniform_(w,gain=nn.nint.calculate_gain(â€˜reluâ€™))""")
    r"""$ \qquad $ 2.æ­£æ€åˆ†å¸ƒï¼š"""
    r"""$\qquad \qquad $ Xavieråˆå§‹åŒ–æ–¹æ³•ä¸­æƒé‡æœä»æ­£æ€åˆ†å¸ƒ:"""
    st.code(r"""W~N(mean,std^2)
mean=0
std=gain*sqrt(2/fan_in+fan_out)
""")
    r"""$ \qquad \qquad $ ç”¨æ³•ï¼š"""
    st.code(r"""torch.nn.init.xavier_normal_(tensor,gain=1)""")
    """- Kaimingåˆå§‹åŒ–ï¼š"""
    r"""$ \qquad $ xavieråˆå§‹åŒ–æ–¹æ³•åœ¨tanhç­‰æ¿€æ´»å‡½æ•°ä¸Šè¡¨ç°çš„å¾ˆå¥½ï¼Œè€Œåœ¨reluè¿™ä¸€ç±»æ¿€æ´»å‡½æ•°è¡¨ç°ä¸ä½³ï¼Œkaimingåˆå§‹åŒ–æ–¹æ³•æ˜¯å¯¹æ­¤è¿›è¡Œçš„æ”¹è¿›ã€‚"""
    r"""$ \qquad $ Motivation: åœ¨ReLUç½‘ç»œä¸­ï¼Œå‡å®šæ¯ä¸€å±‚æœ‰ä¸€åŠçš„ç¥ç»å…ƒè¢«æ¿€æ´»ï¼Œå¦ä¸€åŠä¸º0ã€‚æ‰€ä»¥ï¼Œè¦ä¿æŒæ–¹å·®ä¸å˜ï¼Œåªéœ€è¦åœ¨Xavierçš„åŸºç¡€ä¸Šå†é™¤ä»¥2å³å¯ã€‚"""
    r"""$ \qquad $ 1.å‡åŒ€åˆ†å¸ƒï¼š"""
    st.code(r"""W~U(-bound,bound),bound=sqrt(6/(1+a^2)*fan_in)""")
    r"""$ \qquad \qquad $ ç”¨æ³•ï¼š"""
    st.code(r"""torch.nn.init.kaiming_uniform_(tensor,a=0,mode=â€˜fan_inâ€™,nonlinearity=â€˜leaky_reluâ€™)""")
    r"""$ \qquad \qquad $ å…¶ä¸­ï¼Œaä¸ºæ¿€æ´»å‡½æ•°è´ŸåŠè½´çš„æ–œç‡ï¼Œrelu=0ã€‚"""
    r"""$ \qquad \qquad $ Mode: å¯é€‰ä¸ºfan_inæˆ–fan_outã€‚fan_inä½¿æ­£å‘ä¼ æ’­æ—¶ï¼Œæ–¹å·®ä¸€è‡´ï¼›fan_outä½¿åå‘ä¼ æ’­æ—¶ï¼Œæ–¹å·®ä¸€è‡´ã€‚"""
    r"""$ \qquad \qquad $ Nonlinearity: å¯é€‰reluå’Œleaky_relu,é»˜è®¤å€¼ä¸ºleak_reluã€‚"""
    r"""$ \qquad $ 2.æ­£æ€åˆ†å¸ƒï¼š"""
    st.code(r"""torch.nn.init.kaiming_normal_(tensor,a=0,mode=â€˜fan_inâ€™,nonlinearity=â€˜leaky_reluâ€™)""")
    r"""$ \qquad \qquad $ æ­¤ä¸º0å‡å€¼çš„æ­£å¤ªåˆ†å¸ƒï¼Œå³N~(0,std),ä¸”"""
    st.code(r"""std=sqrt(2/(1+a^2)*fan_in)""")
    r"""$ \qquad \qquad $ å…¶ä¸­ï¼Œaä¸ºæ¿€æ´»å‡½æ•°çš„è´ŸåŠè½´çš„æ–œç‡ï¼Œreluæ˜¯0ã€‚"""
    r"""$ \qquad \qquad $ modeï¼šå¯é€‰ä¸ºfan_inæˆ–fan_out,fan_inä½¿æ­£å‘ä¼ æ’­æ—¶ï¼Œæ–¹å·®ä¸€è‡´ï¼›fan_outä½¿åå‘ä¼ æ’­æ—¶ï¼Œæ–¹å·®ä¸€è‡´ã€‚"""
    r"""$ \qquad \qquad $ nonlinearityï¼šå¯é€‰reluæˆ–leaky_relu,é»˜è®¤å€¼ä¸ºleaky_reluã€‚"""
    """- å…¶ä»–åˆå§‹åŒ–æ–¹å¼ï¼š"""
    r"""$ \qquad $ 1.å‡åŒ€åˆ†å¸ƒåˆå§‹åŒ–ï¼š"""
    st.code(r"""torch.nn.init.uniform_(tensor,a=0,b=1)""")
    r"""$ \qquad \qquad $ ä½¿å€¼æœä»å‡ä¸åˆ†å¸ƒU(a,b)ã€‚"""
    r"""$ \qquad $ 2.Gaussåˆ†å¸ƒåˆå§‹åŒ–ï¼š"""
    st.code(r"""torch.nn.init.normal_(tensor,mean=0,std=1)""")
    r"""$ \qquad \qquad $ ä½¿å€¼æœä»æ­£å¤ªåˆ†å¸ƒN(mean,std),é»˜è®¤å€¼ä¸º0ã€1ã€‚"""
    r"""$ \qquad $ 3.å¸¸æ•°åˆå§‹åŒ–ï¼š"""
    st.code(r"""torch.nn.init.eye_(tensor)""")
    r"""$ \qquad \qquad $ ä½¿å€¼ä¸ºå¸¸æ•°val nn,init,constant_(w,0.3)ã€‚"""
    r"""$ \qquad $ 4.å•ä½çŸ©é˜µåˆå§‹åŒ–ï¼š"""
    st.code(r"""torch.nn.init.constant_(tensor,val)""")
    r"""$ \qquad \qquad $ å°†äºŒç»´tensoråˆå§‹åŒ–ä¸ºå•ä½çŸ©é˜µ(the identity matrix)"""
    r"""$ \qquad $ 5.æ­£äº¤åˆå§‹åŒ–ï¼š"""
    st.code(r"""torch.nn.init.orthogonal_(tensor,gain=1)""")
    r"""$ \qquad \qquad $ ä½¿å¾—tensoræ˜¯æ­£äº¤çš„,æ­£äº¤åˆå§‹åŒ–å¯ä»¥ä½¿å¾—å·ç§¯æ ¸æ›´åŠ ç´§å‡‘ï¼Œå¯ä»¥å»é™¤ç›¸å…³æ€§ï¼Œä½¿æ¨¡å‹æ›´å®¹æ˜“å­¦åˆ°æœ‰æ•ˆçš„å‚æ•°ã€‚"""
    r"""$ \qquad $ 6.ç¨€ç–åˆå§‹åŒ–ï¼š"""
    st.code(r"""torch.nn.init.sparse_(tensor,sparsity,std=0.01)""")
    r"""$ \qquad \qquad $ ä»æ­£å¤ªåˆ†å¸ƒN~(0,std)ä¸­è¿›è¡Œç¨€ç–åŒ–ï¼Œä½¿æ¯ä¸€ä¸ªcolumnæœ‰ä¸€éƒ¨åˆ†ä¸º0ï¼ŒSparsityæ˜¯æ¯ä¸€ä¸ªcolumnç¨€ç–çš„æ¯”ä¾‹ï¼Œå³ä¸º0çš„æ¯”ä¾‹ã€‚"""
    r"""$ \qquad $ 7.è®¡ç®—å¢ç›Šï¼š"""
    st.code(r"""torh.nn.init.calculate_gain(nonlinearity,param=None)""")
    _, col1, _ = st.columns([1, 1, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡36.png', caption='å›¾36')

with tab5:
    """- $L_1,L_2$æ­£åˆ™åŒ–å’Œæƒé‡è¡°å‡ï¼š"""
    r"""$ \qquad $ æ­£åˆ™åŒ–å®šä¹‰ï¼šä¸ºå‡å°‘æµ‹è¯•è¯¯å·®è€Œè®¾è®¡çš„æ˜¾å¼è®­ç»ƒç­–ç•¥ã€‚æ­£åˆ™åŒ–æ˜¯å¯¹å­¦ä¹ ç®—æ³•çš„ä¿®æ”¹â€”â€”æ—¨åœ¨å‡å°‘æ³›åŒ–è¯¯å·®è€Œä¸æ˜¯è®­ç»ƒè¯¯å·®ã€‚"""
    r"""$ \qquad $å‚æ•°èŒƒæ•°æƒ©ç½šï¼šè®¸å¤šæ­£åˆ™åŒ–æ–¹æ³•é€šè¿‡å¯¹ç›®æ ‡å‡½æ•° J æ·»åŠ ä¸€ä¸ªå‚æ•°èŒƒæ•°æƒ©ç½š â„¦(Î¸)ï¼Œé™åˆ¶æ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›ã€‚æˆ‘ä»¬å°†æ­£åˆ™åŒ–åçš„ç›®æ ‡å‡½æ•°è®°ä¸ºï¼š"""
    st.latex(r"""\tilde{J}(\theta;X,y)=J(\theta;X,y)+\alpha{\Omega{(\theta)}}""")
    r"""$ \qquad $ åœ¨ç¥ç»ç½‘ç»œä¸­æˆ‘ä»¬é€šå¸¸åªå¯¹æ¯ä¸€å±‚ä»¿å°„å˜æ¢çš„æƒé‡åšæƒ©ç½šè€Œä¸å¯¹åç½®åšæ­£åˆ™æƒ©ç½šã€‚æ¯ä¸ªæƒé‡ä¼šæŒ‡å®šä¸¤ä¸ªå˜é‡å¦‚ä½•ç›¸äº’ä½œç”¨ï¼›æ¯ä¸ªåç½®ä»…æ§åˆ¶ä¸€ä¸ªå•å˜é‡ã€‚è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬ä¸å¯¹å…¶è¿›è¡Œæ­£åˆ™åŒ–ä¹Ÿä¸ä¼šå¯¼è‡´å¤ªå¤§çš„æ–¹å·®ã€‚"""
    r"""$ \qquad $ $L_1$å‚æ•°æ­£åˆ™åŒ–ï¼š"""
    st.latex(r"""\Omega{(\theta)}=\Vert \omega \Vert_1=\sum_i{|\omega_i|}""")
    r"""$ \qquad $ $L_2$å‚æ•°æ­£åˆ™åŒ–(ä¹Ÿè¢«ç§°ä¸ºæƒé‡è¡°å‡/å²­å›å½’/Tikhonovæ­£åˆ™)ï¼š"""
    st.latex(r"""\Omega{(\theta)}=\frac{1}{2}\Vert \omega \Vert_2^2""")
    r"""$ \qquad $ é€šè¿‡å‘ç›®æ ‡å‡½æ•°æ·»åŠ ä¸€ä¸ªæ­£åˆ™é¡¹ï¼Œä½¿æƒé‡æ›´åŠ æ¥è¿‘åŸç‚¹ã€‚"""
    r"""$ \qquad $ L2æ­£åˆ™åŒ–çš„ä½œç”¨åœ¨äºå‰Šå‡æƒé‡ï¼Œé™ä½æ¨¡å‹è¿‡æ‹Ÿåˆï¼Œå…¶è¡Œä¸ºç›´æ¥å¯¼è‡´æ¯è½®è¿­ä»£è¿‡ç¨‹ä¸­çš„æƒé‡weightå‚æ•°è¢«å‰Šå‡/æƒ©ç½šä¸€éƒ¨åˆ†ï¼Œæ•…ä¹Ÿç§°ä¸ºæƒé‡è¡°å‡ã€‚"""
    r"""$ \qquad $ ä»è¿™ä¸ªè§’åº¦çœ‹ï¼Œä¸è®ºç”¨L1æ­£åˆ™åŒ–è¿˜æ˜¯L2æ­£åˆ™åŒ–ï¼Œäº¦æˆ–æ˜¯å…¶å®ƒæ­£åˆ™åŒ–æ–¹æ³•ï¼Œåªè¦æ˜¯å‰Šå‡äº†æƒé‡ï¼Œé‚£éƒ½å¯ä»¥ç§°ä¸ºweight decayã€‚"""
    r"""$ \qquad $ L1,L2æ­£åˆ™åŒ–å‡å°‘æƒé‡ä½¿å¾—ç½‘ç»œå¯¹ä¸¢å¤±ç‰¹å®šç¥ç»å…ƒè¿æ¥çš„é²æ£’æ€§æé«˜ã€‚"""

    """- Batch Normalizationï¼š"""
    r"""$ \qquad $ éšç€è®­ç»ƒçš„è¿›è¡Œï¼Œç½‘ç»œä¸­çš„å‚æ•°ä¹Ÿéšç€æ¢¯åº¦ä¸‹é™å†ä¸æ–­æ›´æ–°ã€‚"""
    r"""$ \qquad \qquad $ ä¸€æ–¹é¢ï¼Œå½“åº•å±‚ç½‘ç»œä¸­å‚æ•°å‘ç”Ÿå¾®å¼±å˜åŒ–æ—¶ï¼Œç”±äºæ¯ä¸€å±‚ä¸­çš„çº¿æ€§å˜æ¢ä¸éçº¿æ€§æ¿€æ´»æ˜ å°„ï¼Œè¿™äº›å¾®å¼±å˜æ¢éšç€ç½‘ç»œå±‚æ•°çš„åŠ æ·±è€Œè¢«æ”¾å¤§ï¼ˆç±»ä¼¼è´è¶æ•ˆåº”ï¼‰ã€‚"""
    r"""$ \qquad \qquad $ å¦ä¸€æ–¹é¢ï¼Œå‚æ•°çš„å˜åŒ–å¯¼è‡´æ¯å±‚çš„è¾“å…¥åˆ†å¸ƒä¼šå‘ç”Ÿæ”¹å˜ï¼Œè¿›è€Œä¸Šå±‚çš„ç½‘ç»œéœ€è¦ä¸åœåœ°å»é€‚åº”è¿™äº›åˆ†å¸ƒå˜åŒ–ï¼Œä½¿å¾—æˆ‘ä»¬çš„æ¨¡å‹è®­ç»ƒå˜å¾—å›°éš¾ã€‚ä¸Šè¿°è¿™ä¸€ç°è±¡å«åšInternal Covariate Shiftã€‚"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡37.png', caption='å›¾37')
    r"""$ \qquad $ 1.ä»€ä¹ˆæ˜¯Internal Covariate Shift?"""
    r"""$ \qquad \qquad $ å®šä¹‰ï¼šåœ¨æ·±å±‚ç½‘ç»œè®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºç½‘ç»œä¸­å‚æ•°å˜åŒ–è€Œå¼•èµ·å†…éƒ¨èŠ‚ç‚¹æ•°æ®åˆ†å¸ƒå‘ç”Ÿå˜åŒ–çš„è¿™ä¸€è¿‡ç¨‹è¢«ç§°ä½œInternal Covariate Shiftã€‚"""
    r"""$ \qquad \qquad $ è§£é‡Šï¼šæˆ‘ä»¬å®šä¹‰æ¯ä¸€å±‚çš„çº¿æ€§å˜æ¢ä¸º$ Z^{[l]}=W^{[l]}\times{input}+b^{[l]} $ï¼Œå…¶ä¸­lä»£è¡¨å±‚æ•°ï¼›éçº¿æ€§å˜æ¢ä¸º$ A^{[l]}=g^{[l]}(Z^{[l]}) $,å…¶ä¸­$g^{[l]}(\cdot)$ä¸ºç¬¬lå±‚çš„æ¿€æ´»å‡½æ•°ã€‚éšç€æ¢¯åº¦ä¸‹é™çš„è¿›è¡Œï¼Œæ¯ä¸€å±‚çš„å‚æ•°$W^{[l]}$ä¸$b^{[l]}$éƒ½ä¼šè¢«æ›´æ–°ï¼Œé‚£ä¹ˆ$Z^{[l]}$çš„åˆ†å¸ƒä¹Ÿå°±å‘ç”Ÿäº†æ”¹å˜ï¼Œè¿›è€Œğ´^([ğ‘™]) ä¹ŸåŒæ ·å‡ºç°åˆ†å¸ƒçš„æ”¹å˜ã€‚è€Œ$A^{[l]}$ä½œä¸ºç¬¬l+1å±‚çš„è¾“å…¥ï¼Œæ„å‘³ç€l+1å±‚å°±éœ€è¦å»ä¸åœåœ°é€‚åº”è¿™ç§æ•°æ®åˆ†å¸ƒçš„å˜åŒ–ï¼Œè¿™ä¸€è¿‡ç¨‹å°±è¢«å«åšInternal Covariate Shiftã€‚
"""
    r"""$ \qquad $2.Internal Covariate Shiftä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ"""
    r"""$ \qquad \qquad $ ä¸Šå±‚ç½‘ç»œéœ€è¦ä¸åœåœ°è°ƒæ•´æ¥é€‚åº”è¾“å…¥æ•°æ®åˆ†å¸ƒçš„å˜åŒ–ï¼Œå¯¼è‡´ç½‘ç»œå­¦ä¹ é€Ÿç‡çš„é™ä½ã€‚"""
    r"""$ \qquad \qquad $ ç½‘ç»œçš„è®­ç»ƒè¿‡ç¨‹å®¹æ˜“é™·å…¥æ¢¯åº¦é¥±å’ŒåŒºï¼Œå‡ç¼“ç½‘ç»œæ”¶æ•›é€Ÿåº¦ã€‚"""
    r"""$ \qquad \qquad $å¯¹äºæ¿€æ´»å‡½æ•°æ¢¯åº¦é¥±å’Œé—®é¢˜ï¼Œæœ‰ä¸¤ç§è§£å†³æ€è·¯ï¼š"""
    r"""$ \qquad \qquad \qquad $ ç¬¬ä¸€ç§å°±æ˜¯æ›´ä¸ºéé¥±å’Œæ€§æ¿€æ´»å‡½æ•°ï¼Œä¾‹å¦‚çº¿æ€§æ•´æµå‡½æ•°ReLUå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³è®­ç»ƒè¿›å…¥æ¢¯åº¦é¥±å’ŒåŒºçš„é—®é¢˜ã€‚"""
    r"""$ \qquad \qquad \qquad $ å¦ä¸€ç§æ€è·¯æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è®©æ¿€æ´»å‡½æ•°çš„è¾“å…¥åˆ†å¸ƒä¿æŒåœ¨ä¸€ä¸ªç¨³å®šçŠ¶æ€æ¥å°½å¯èƒ½åœ°é¿å…å®ƒä»¬é™·å…¥æ¢¯åº¦é¥±å’ŒåŒºï¼Œè¿™ä¹Ÿå°±æ˜¯Normalizationçš„æ€è·¯ã€‚"""
    r"""$ \qquad $ 3.å¦‚ä½•å‡ç¼“Internal Covariate Shift?"""
    r"""$ \qquad \qquad $ ICSäº§ç”Ÿçš„åŸå› æ˜¯ç”±äºå‚æ•°æ›´æ–°æŠµèµ–çš„ç½‘ç»œä¸­æ¯ä¸€å±‚è¾“å…¥å€¼åˆ†å¸ƒçš„æ”¹å˜ï¼Œå¹¶ä¸”éšç€ç½‘ç»œå±‚æ•°çš„åŠ æ·±è€Œå˜å¾—æ›´åŠ ä¸¥é‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å›ºå®šæ¯ä¸€å±‚ç½‘ç»œè¾“å…¥å€¼çš„åˆ†å¸ƒæ¥å‡ç¼“ICSé—®é¢˜ã€‚"""
    r"""$ \qquad \qquad $ (1)ç™½åŒ–ï¼šç™½åŒ–(Whitening)æ˜¯æœºå™¨å­¦ä¹ é‡Œé¢å¸¸ç”¨çš„ä¸€ç§è§„èŒƒåŒ–æ•°æ®åˆ†å¸ƒçš„æ–¹æ³•ï¼Œä¸»è¦æ˜¯PCAç™½åŒ–ä¸ZCAç™½åŒ–ã€‚ç™½åŒ–æ˜¯å¯¹è¾“å…¥æ•°æ®åˆ†å¸ƒè¿›è¡Œå˜æ¢ï¼Œè¿›è€Œè¾¾åˆ°ä»¥ä¸‹ä¸¤ä¸ªç›®çš„ï¼Œ"""
    r"""$ \qquad \qquad \qquad $ 1)ä½¿å¾—è¾“å…¥ç‰¹å¾åˆ†å¸ƒå…·æœ‰ç›¸åŒçš„å‡å€¼ä¸æ–¹å·®ã€‚å…¶ä¸­PCAç™½åŒ–ä¿è¯äº†æ‰€æœ‰ç‰¹å¾åˆ†å¸ƒå‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1ï¼›è€ŒZCAç™½åŒ–åˆ™ä¿è¯äº†æ‰€æœ‰ç‰¹å¾åˆ†å¸ƒå‡å€¼ä¸º0ï¼Œæ–¹å·®ç›¸åŒã€‚
"""
    r"""$ \qquad \qquad \qquad $ 2)å»é™¤ç‰¹å¾ä¹‹é—´çš„ç›¸å…³æ€§ã€‚é€šè¿‡ç™½åŒ–æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å‡ç¼“ICSçš„é—®é¢˜ï¼Œè¿›è€Œå›ºå®šäº†æ¯ä¸€å±‚ç½‘è·¯è¾“å…¥åˆ†å¸ƒï¼ŒåŠ é€Ÿç½‘ç»œè®­ç»ƒè¿‡ç¨‹çš„æ”¶æ•›ã€‚"""
    r"""$ \qquad \qquad $ (2)Batch Normalizationï¼š"""
    r"""$ \qquad \qquad \qquad $ ç™½åŒ–ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š1)ç™½åŒ–è¿‡ç¨‹è®¡ç®—æˆæœ¬å¤ªé«˜ï¼Œå¹¶ä¸”åœ¨æ¯ä¸€è½®è®­ç»ƒä¸­çš„æ¯ä¸€å±‚æˆ‘ä»¬éƒ½éœ€è¦åšå¦‚æ­¤é«˜æˆæœ¬è®¡ç®—çš„ç™½åŒ–æ“ä½œï¼›2)ç™½åŒ–è¿‡ç¨‹ç”±äºæ”¹å˜äº†ç½‘ç»œæ¯ä¸€å±‚çš„åˆ†å¸ƒï¼Œå› è€Œæ”¹å˜äº†ç½‘ç»œå±‚ä¸­æœ¬èº«æ•°æ®çš„è¡¨è¾¾èƒ½åŠ›ã€‚åº•å±‚ç½‘ç»œå­¦ä¹ åˆ°çš„å‚æ•°ä¿¡æ¯ä¼šè¢«ç™½åŒ–æ“ä½œä¸¢å¤±æ‰ã€‚"""
    r"""$ \qquad \qquad \qquad $ æ€è·¯ï¼š1)ç®€åŒ–è®¡ç®—è¿‡ç¨‹ï¼Œå•ç‹¬å¯¹æ¯ä¸ªç‰¹å¾è¿›è¡Œnormalizationï¼Œè®©æ¯ä¸ªç‰¹å¾éƒ½æœ‰å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1çš„åˆ†å¸ƒã€‚2)åŠ çº¿æ€§å˜æ¢æ“ä½œï¼Œè®©è¿™äº›æ•°æ®å†èƒ½å¤Ÿå°½å¯èƒ½æ¢å¤æœ¬èº«çš„è¡¨è¾¾èƒ½åŠ›ã€‚"""
    r"""$ \qquad $ 4.ç®—æ³•æ­¥éª¤ï¼š"""
    r"""$ \qquad \qquad $ 1.è€ƒè™‘ä¸€ä¸ªbatchçš„è®­ç»ƒï¼Œä¼ å…¥mä¸ªè®­ç»ƒæ ·æœ¬ï¼Œå¹¶å…³æ³¨ç½‘ç»œä¸­çš„æŸä¸€å±‚(ç¬¬lå±‚)$Z\in{R^{d_l\times{m}}}$ã€‚æˆ‘ä»¬å…³æ³¨å½“å‰å±‚çš„ç¬¬jä¸ªç»´åº¦ï¼Œä¹Ÿå°±æ˜¯ç¬¬jä¸ªç¥ç»å…ƒèŠ‚ç‚¹ï¼Œåˆ™æœ‰$Z_j\in{R^{d_l\times{m}}}$ã€‚æˆ‘ä»¬å½“å‰ç»´åº¦è¿›è¡Œè§„èŒƒåŒ–ï¼š
"""
    st.latex(r"""\mu_j=\frac{1}{m}\sum_{i=1}^m{Z_{j}^{(i)}}""")
    st.latex(r"""\sigma_j^2=\frac{1}{m}\sum_{i=1}^m{(Z_J^{(i)}-\mu_j)^2}""")
    st.latex(r"""\hat{Z}_j=\frac{Z_j-\mu_j}{\sqrt{\sigma_j^2+\varepsilon}}""")
    r"""$ \qquad \qquad $ å…¶ä¸­$\varepsilon$æ˜¯ä¸ºäº†é˜²æ­¢æ–¹å·®ä¸º0äº§ç”Ÿæ— æ•ˆè®¡ç®—ã€‚é€šè¿‡è¿™ç§æ“ä½œï¼Œç”¨æ›´åŠ ç®€åŒ–çš„æ–¹å¼æ¥å¯¹æ•°æ®è¿›è¡Œè§„èŒƒã€‚"""
    r"""$ \qquad \qquad $ 2.å¼•å…¥ä¸¤ä¸ªå¯å­¦ä¹ (learnable)çš„å‚æ•°$\gamma,\beta$ã€‚è¿™ä¸¤ä¸ªå‚æ•°çš„å¼•å…¥æ˜¯ä¸ºäº†æ¢å¤æ•°æ®æœ¬èº«çš„è¡¨è¾¾èƒ½åŠ›ï¼Œå¯¹è§„èŒƒåŒ–åçš„æ•°æ®è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œå³"""
    st.latex(r"""\tilde{Z}_j=\gamma_j{\hat{Z}_j}+\beta_j""")
    r"""$ \qquad \qquad $ ç‰¹åˆ«åœ°ï¼Œå½“$\gamma^2=\sigma^2,\beta=\mu$æ—¶ï¼Œå¯ä»¥å®ç°ç­‰ä»·å˜æ¢(identity transform)å¹¶ä¸”ä¿ç•™äº†åŸå§‹è¾“å…¥ç‰¹å¾çš„åˆ†å¸ƒä¿¡æ¯ã€‚"""
    r"""$ \qquad \qquad $ åŒæ—¶ï¼Œåœ¨è¿›è¡Œnormalizationçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºæˆ‘ä»¬çš„è§„èŒƒåŒ–æ“ä½œä¼šå‡å»å‡å€¼ï¼Œå› æ­¤åç½®é¡¹bå¯ä»¥è¢«å¿½ç•¥æ‰æˆ–å¯ä»¥è¢«ç½®ä¸º0ï¼Œå³"""
    st.latex(r"""BN(W\mu+b)=BN(W\mu)""")
    r"""$ \qquad $ 5.æµ‹è¯•é˜¶æ®µå¦‚ä½•ä½¿ç”¨Batch Normalization?"""
    r"""$ \qquad \qquad $ åœ¨é¢„æµ‹é˜¶æ®µï¼Œæœ‰å¯èƒ½åªéœ€è¦é¢„æµ‹ä¸€ä¸ªæ ·æœ¬æˆ–å¾ˆå°‘çš„æ ·æœ¬ï¼Œæ²¡æœ‰åƒè®­ç»ƒæ ·æœ¬ä¸­é‚£ä¹ˆå¤šæ•°æ®ã€‚æ­¤æ—¶$ \mu,\sigma^2 $çš„è®¡ç®—ä¸€å®šæ˜¯æœ‰åä¼°è®¡ï¼Œè¿™æ—¶åº”å¦‚ä½•è¿›è¡Œè®¡ç®—å‘¢ï¼Ÿ"""
    r"""$ \qquad \qquad $ 1.åˆ©ç”¨BNè®­ç»ƒå¥½æ¨¡å‹åï¼Œæ— ä¿ç•™æ¯ç»„mini_batchè®­ç»ƒæ•°æ®åœ¨ç½‘ç»œä¸­æ¯ä¸€å±‚çš„$ \mu_{ğ‘ğ‘ğ‘¡ğ‘â„} $ï¼Œ$ \sigma_{ğ‘ğ‘ğ‘¡ğ‘â„}^2 $ã€‚æ­¤æ—¶æˆ‘ä»¬ä½¿ç”¨æ•´ä¸ªæ ·æœ¬çš„ç»Ÿè®¡é‡æ¥å¯¹æµ‹è¯•æ•°æ®è¿›è¡Œå½’ä¸€åŒ–ï¼Œå…·ä½“æ¥è¯´ä½¿ç”¨å‡å€¼ä¸æ–¹å·®çš„æ— åä¼°è®¡ï¼š"""
    st.latex(r"""\mu_{test}=E(\mu_{batch})""")
    st.latex(r"""\sigma_{test}^2=\frac{m}{m-1}E(\sigma_{batch}^2)""")
    r"""$ \qquad \qquad $ å¾—åˆ°æ¯ä¸ªç‰¹å¾çš„å‡å€¼ä¸æ–¹å·®çš„æ— åä¼°è®¡åï¼Œæˆ‘ä»¬å¯¹testæ•°æ®é‡‡ç”¨åŒæ ·çš„normalizationæ–¹æ³•ï¼š"""
    st.latex(r"""BN(X_{test})=\gamma{\cdot{\frac{X_{test}-\mu_{test}}{\sqrt{\sigma_{test}^2+\varepsilon}}}}+\beta""")
    r"""$ \qquad \qquad $ 2.é™¤äº†é‡‡ç”¨æ•´ä½“æ ·æœ¬çš„æ— åä¼°è®¡å¤–ï¼Œå´æ©è¾¾æŒ‡å‡ºå¯ä»¥å¯¹trainé˜¶æ®µæ¯ä¸ªbatchè®¡ç®—çš„mean/varianceé‡‡ç”¨æŒ‡æ•°åŠ æƒå¹³å‡æ¥å¾—åˆ°testé˜¶æ®µmean/varianceçš„ä¼°è®¡ã€‚"""
    r"""$ \qquad $ 6.Batch Normalizationçš„ä¼˜åŠ¿ï¼š"""
    r"""$ \qquad \qquad $ (1)BNä½¿å¾—ç½‘ç»œä¸­æ¯å±‚è¾“å…¥æ•°æ®çš„åˆ†å¸ƒç›¸å¯¹ç¨³å®šï¼ŒåŠ é€Ÿæ¨¡å‹å­¦ä¹ é€Ÿåº¦ã€‚"""
    r"""$ \qquad \qquad $ (2)BNä½¿å¾—æ¨¡å‹å¯¹ç½‘ç»œä¸­çš„å‚æ•°ä¸é‚£ä¹ˆæ•æ„Ÿï¼Œç®€åŒ–è°ƒå‚è¿‡ç¨‹ï¼Œä½¿å¾—ç½‘ç»œå­¦ä¹ æ›´åŠ ç¨³å®šã€‚"""
    r"""$ \qquad \qquad $ (3)BNå…è®¸ç½‘ç»œä½¿ç”¨é¥±å’Œæ€§æ¿€æ´»å‡½æ•°ï¼ˆä¾‹å¦‚sigmoid,tanhç­‰ï¼‰ï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚"""
    r"""$ \qquad \qquad $ (4)BNå…·æœ‰ä¸€å®šçš„æ­£åˆ™åŒ–æ•ˆæœã€‚å°½ç®¡æ¯ä¸€ä¸ªbatchä¸­çš„æ•°æ®éƒ½æ˜¯ä»æ€»ä½“æ ·æœ¬ä¸­æŠ½æ ·å¾—åˆ°ï¼Œä½†ä¸åŒmini-batchçš„å‡å€¼ä¸æ–¹å·®ä¼šæœ‰æ‰€ä¸åŒï¼Œè¿™å°±ä¸ºç½‘ç»œçš„å­¦ä¹ è¿‡ç¨‹ä¸­å¢åŠ äº†éšæœºå™ªéŸ³ï¼Œä¸Dropouté€šè¿‡å…³é—­ç¥ç»å…ƒç½‘ç»œè®­ç»ƒå¸¦æ¥å™ªéŸ³ç±»ä¼¼ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¹æ¨¡å‹èµ·åˆ°äº†æ­£åˆ™åŒ–çš„æ•ˆæœã€‚"""

    """- Dropoutï¼š"""
    r"""$ \qquad $ Dropoutçš„æå‡ºï¼Œæºäº2012å¹´Hintonçš„ä¸€ç¯‡è®ºæ–‡--ã€ŠImproving neural networks by preventing co-adaptation of feature detectorsã€‹ã€‚è®ºæ–‡ä¸­æè¿°äº†å½“æ•°æ®é›†è¾ƒå°æ—¶è€Œç¥ç»ç½‘ç»œæ¨¡å‹è¾ƒå¤§è¾ƒä¸ºå¤æ‚æ—¶ï¼Œè®­ç»ƒå¾ˆå®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆï¼Œä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œå¯ä»¥é€šè¿‡ç»„ç»‡ç‰¹å¾æ£€æµ‹å™¨é—´çš„å…±åŒä½œç”¨æ¥æé«˜æ¨¡å‹æ€§èƒ½ã€‚"""
    r"""$ \qquad $ Dropouté€šè¿‡åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­éšæœºä¸¢æ‰éƒ¨åˆ†ç¥ç»å…ƒæ¥å‡å°ç¥ç»ç½‘ç»œçš„è§„æ¨¡ä»è€Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚"""
    r"""$ \qquad $ Dropoutå·¥ä½œåŸç†ï¼šæˆ‘ä»¬åœ¨å‰å‘ä¼ æ’­çš„æ—¶å€™ï¼Œè®©æŸä¸ªç¥ç»å…ƒçš„æ¿€æ´»å€¼ä»¥ä¸€å®šçš„æ¦‚ç‡påœæ­¢å·¥ä½œï¼Œè¿™æ ·å¯ä»¥ä½¿æ¨¡å‹æ³›åŒ–æ€§æ›´å¼ºï¼Œå› ä¸ºå®ƒä¸ä¼šå¤ªä¾èµ–æŸäº›å±€éƒ¨çš„ç‰¹å¾ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ """
    _, col1, _ = st.columns([1, 2, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡38.png', caption='å›¾38')
    r"""$ \qquad $ å·¥ä½œæµç¨‹ï¼š"""
    r"""$ \qquad \qquad $ å‡è®¾æˆ‘ä»¬è¦è®­ç»ƒè¿™æ ·ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œå¦‚å›¾æ‰€ç¤ºã€‚"""
    _, col1, _ = st.columns([1, 2, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡39.png', caption='å›¾39')
    r"""$ \qquad \qquad $ è¾“å…¥æ˜¯xï¼Œè¾“å‡ºæ˜¯y,æ­£å¸¸çš„æµç¨‹æ˜¯ï¼šé¦–å…ˆæŠŠxé€šè¿‡ç½‘ç»œå‰å‘ä¼ æ’­ï¼Œç„¶åæŠŠè¯¯å·®åå‘ä¼ æ’­ä»¥å†³å®šå¦‚ä½•æ›´æ–°å‚æ•°è®©ç½‘ç»œè¿›è¡Œå­¦ä¹ ã€‚ä½¿ç”¨Dropoutä¹‹åï¼Œè¿‡ç¨‹å˜æˆå¦‚ä¸‹ï¼š"""
    r"""$ \qquad \qquad $ ï¼ˆ1ï¼‰é¦–å…ˆéšæœºï¼ˆä¸´æ—¶ï¼‰åˆ æ‰ç½‘æ ¼ä¸­ä¸€åŠçš„éšè—ç¥ç»å…ƒï¼Œè¾“å…¥è¾“å‡ºç¥ç»å…ƒä¿æŒä¸å˜ï¼Œå›¾ä¸­è™šçº¿ä¸ºéƒ¨åˆ†ä¸´æ—¶è¢«åˆ é™¤çš„ç¥ç»å…ƒ ã€‚"""
    r"""$ \qquad \qquad $ ï¼ˆ2ï¼‰æŠŠè¾“å…¥xé€šè¿‡ä¿®æ”¹åçš„ç½‘æ ¼å‰å‘ä¼ æ’­ï¼Œç„¶åæŠŠå¾—åˆ°çš„æŸå¤±ç»“æœé€šè¿‡ä¿®æ”¹çš„ç½‘ç»œåå‘ä¼ æ’­ã€‚ä¸€å°æ‰¹è®­ç»ƒæ ·æœ¬æ‰§è¡Œå®Œè¿™ä¸ªè¿‡ç¨‹åï¼Œåœ¨æ²¡æœ‰è¢«åˆ é™¤çš„ç¥ç»å…ƒä¸ŠæŒ‰ç…§éšæœºæ¢¯åº¦ä¸‹é™æ³•æ›´æ–°å¯¹åº”çš„å‚æ•°(w,b)ã€‚"""
    _, col1, _ = st.columns([1, 2, 1])
    with col1:
        st.image('./chapter2_DFNN/pages/å›¾ç‰‡/å›¾ç‰‡40.png', caption='å›¾40')
    r"""$ \qquad \qquad $ (3)ç„¶åç»§ç»­é‡å¤è¿™ä¸€è¿‡ç¨‹ï¼š"""
    r"""$ \qquad \qquad $ æ¢å¤è¢«åˆ æ‰çš„ç¥ç»å…ƒï¼ˆæ­¤æ—¶è¢«åˆ é™¤çš„ç¥ç»å…ƒä¿æŒåŸæ ·ï¼Œè€Œæ²¡æœ‰è¢«åˆ é™¤çš„ç¥ç»å…ƒå·²ç»æœ‰æ‰€æ›´æ–°ï¼‰"""
    r"""$ \qquad \qquad $ ä»éšè—å±‚ç¥ç»å…ƒä¸­éšæœºé€‰æ‹©ä¸€ä¸ªä¸€åŠå¤§å°çš„å­é›†ä¸´æ—¶åˆ é™¤æ‰ï¼ˆå¤‡ä»½è¢«åˆ é™¤ç¥ç»å…ƒçš„å‚æ•°ï¼‰ã€‚"""
    r"""$ \qquad \qquad $å¯¹å°æ‰¹è®­ç»ƒæ ·æœ¬ï¼Œå…ˆå‰å‘ä¼ æ’­ç„¶ååå‘ä¼ æ’­æŸå¤±å¹¶æ ¹æ®æ¢¯åº¦ä¸‹é™æ³•æ›´æ–°å‚æ•°(w,b)(æ²¡æœ‰è¢«åˆ é™¤çš„é‚£ä¸€éƒ¨åˆ†å‚æ•°å¾—åˆ°æ›´æ–°ï¼Œåˆ é™¤çš„ç¥ç»å…ƒå‚æ•°ä¿æŒè¢«åˆ é™¤å‰çš„ç»“æœ)ã€‚"""
    r"""$ \qquad \qquad $ ä¸æ–­é‡å¤è¿‡ç¨‹(3)ã€‚"""
    r"""$ \qquad $ ä¸ºä»€ä¹ˆè¯´Dropoutå¯ä»¥è§£å†³è¿‡æ‹Ÿåˆé—®é¢˜ï¼Ÿ"""
    r"""$ \qquad \qquad $ 1. å–å¹³å‡çš„ä½œç”¨ã€‚dropoutæ‰ä¸åŒçš„éšè—ç¥ç»å…ƒå°±ç±»ä¼¼åœ¨è®­ç»ƒä¸åŒçš„ç½‘ç»œï¼Œéšæœºåˆ æ‰ä¸€åŠéšè—ç¥ç»å…ƒå¯¼è‡´ç½‘ç»œç»“æ„å·²ç»ä¸åŒï¼Œæ•´ä¸ªdropoutè¿‡ç¨‹å°±ç›¸å½“äºå¯¹å¤šä¸ªä¸åŒçš„ç¥ç»ç½‘ç»œå–å¹³å‡ã€‚è€Œä¸åŒçš„ç½‘ç»œäº§ç”Ÿä¸åŒçš„è¿‡æ‹Ÿåˆï¼Œä¸€äº›äº’ä¸ºâ€œåå‘â€çš„æ‹Ÿåˆç›¸äº’ä½æ•ˆå°±å¯ä»¥è¾¾åˆ°æ•´ä½“ä¸Šå‡å°‘è¿‡æ‹Ÿåˆã€‚"""
    r"""$ \qquad \qquad $ 2. å‡å°‘ç¥ç»å…ƒä¹‹é—´å¤æ‚çš„å…±é€‚åº”å…³ç³»ã€‚å› ä¸ºdropoutç¨‹åºå¯¼è‡´ä¸¤ä¸ªç¥ç»å…ƒä¸ä¸€å®šæ¯æ¬¡éƒ½åœ¨ä¸€ä¸ªdropoutç½‘ç»œä¸­å‡ºç°ã€‚è¿™æ ·æƒå€¼çš„æ›´æ–°ä¸å†ä¾èµ–äºæœ‰å›ºå®šå…³ç³»çš„éšå«èŠ‚ç‚¹çš„å…±åŒä½œç”¨ï¼Œç»„ç»‡äº†æŸäº›ç‰¹å¾ä»…ä»…åœ¨å…¶å®ƒç‰¹å¾ä¸‹æ‰æœ‰æ•ˆçš„æƒ…å†µã€‚å³ä½¿ä¸¢å¤±ç‰¹å®šçš„çº¿ç´¢ï¼Œå®ƒä¹Ÿåº”è¯¥å¯ä»¥ä»ä¼—å¤šå…¶å®ƒçº¿ç´¢ä¸­å­¦ä¹ ä¸€äº›å…±åŒçš„ç‰¹å¾ã€‚"""
    r"""$ \qquad \qquad $ 3. é€šè¿‡å…³é—­ç¥ç»å…ƒç½‘ç»œè®­ç»ƒå¸¦æ¥å™ªéŸ³ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¹æ¨¡å‹èµ·åˆ°äº†æ­£åˆ™åŒ–çš„æ•ˆæœã€‚"""
    r"""$ \qquad \qquad $"""
    """- Data Augmentationï¼š"""
    r"""$ \qquad $ 1.æ—‹è½¬ $\qquad$ 2.ç¿»è½¬ $\qquad$ 3.è£å‰ª $\qquad$ 4.ç¼©æ”¾ $\qquad$ 5.å¹³ç§» $\qquad$ 6.åŠ å™ªå£°"""

    """- Early stoppingï¼š"""
    r"""$ \qquad $ æå‰åœæ­¢ï¼ˆEarly Stopï¼‰å¯¹äºæ·±åº¦ç¥ç»ç½‘ç»œæ¥è¯´æ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„æ­£åˆ™åŒ–æ–¹æ³•ã€‚"""
    r"""$ \qquad $ ç”±äºæ·±åº¦ç¥ç»ç½‘ç»œçš„æ‹Ÿåˆèƒ½åŠ›éå¸¸å¼ºï¼Œå› æ­¤æ¯”è¾ƒå®¹æ˜“åœ¨è®­ç»ƒé›†ä¸Šè¿‡æ‹Ÿåˆã€‚"""
    r"""$ \qquad $ åœ¨ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå’Œè®­ç»ƒé›†ç‹¬ç«‹çš„æ ·æœ¬é›†åˆï¼Œç§°ä¸ºéªŒè¯é›†ï¼ˆValidation Set)ï¼Œå¹¶ç”¨éªŒè¯é›†ä¸Šçš„é”™è¯¯æ¥ä»£æ›¿æœŸæœ›é”™è¯¯ï¼å½“éªŒè¯é›†ä¸Šçš„é”™è¯¯ç‡ä¸å†ä¸‹é™ï¼Œå°±åœæ­¢è¿­ä»£ã€‚"""

with tab6:
    with st.expander('code'):
        st.code("""
import torch
import torch.nn as nn
import torchvision                          #torchä¸­ç”¨æ¥å¤„ç†å›¾åƒçš„åº“
from torchvision import datasets,transforms
import matplotlib.pyplot as plt

#è®¾ç½®ä¸€äº›è¶…å‚
num_epochs = 1        #è®­ç»ƒçš„å‘¨æœŸ
batch_size = 100      #æ‰¹è®­ç»ƒçš„æ•°é‡
learning_rate = 0.001 #å­¦ä¹ ç‡ï¼ˆ0.1,0.01,0.001ï¼‰

#å¯¼å…¥è®­ç»ƒæ•°æ®
train_dataset = datasets.MNIST(root='E:/MNIST/',                #æ•°æ®é›†ä¿å­˜è·¯å¾„
                               train=True,                      #æ˜¯å¦ä½œä¸ºè®­ç»ƒé›†
                               transform=transforms.ToTensor(), #æ•°æ®å¦‚ä½•å¤„ç†, å¯ä»¥è‡ªå·±è‡ªå®šä¹‰
                               download=False)                  #è·¯å¾„ä¸‹æ²¡æœ‰çš„è¯, å¯ä»¥ä¸‹è½½
                             
#å¯¼å…¥æµ‹è¯•æ•°æ®
test_dataset = datasets.MNIST(root='E:/MNIST/',
                              train=False,
                              transform=transforms.ToTensor())                                                    
train_loader = torch.utils.data.DataLoader(dataset=train_dataset, #åˆ†æ‰¹
                                           batch_size=batch_size,
                                           shuffle=True)          #éšæœºåˆ†æ‰¹

test_loader = torch.utils.data.DataLoader(dataset=test_dataset,
                                          batch_size=batch_size,
                                          shuffle=False)

class MLP(nn.Module):                    #ç»§æ‰¿nn.module
	def __init__(self):
	super(MLP, self).__init__()      #ç»§æ‰¿çš„ä½œç”¨
        self.layer1 = nn.Linear(784,300)
        self.relu = nn.ReLU()
        self.layer2 = nn.Linear(300,10)

        def forward(self,x):             #ç½‘ç»œä¼ æ’­çš„ç»“æ„
        x = x.reshape(-1, 28*28)
        x = self.layer1(x)
        x = self.relu(x)
        y = self.layer2(x)
        return y

loss_func = nn.CrossEntropyLoss()
optimizer = torch.optim.Adam(mlp.parameters(), lr=learning_rate)

for epoch in range(num_epochs):
    for i, (images, labels) in enumerate(train_loader):
        outputs = mlp(images)
        loss = loss_func(outputs, labels)
        optimizer.zero_grad()                          #æ¸…é›¶æ¢¯åº¦
        loss.backward()                                #åå‘æ±‚æ¢¯åº¦
        optimizer.step()
        
        if (i+1) % 100 == 0:
            print('Epoch [{}/{}], Loss: {:.4f}'.format(epoch + 1, num_epochs, loss.item()))

#æµ‹è¯•æ¨¡å‹
mlp.eval()      #æµ‹è¯•æ¨¡å¼ï¼Œå…³é—­æ­£åˆ™åŒ–
correct = 0
total = 0
for images, labels in test_loader:
    outputs = mlp(images)
    _, predicted = torch.max(outputs, 1)   #è¿”å›å€¼å’Œç´¢å¼•
    total += labels.size(0)
    correct += (predicted == labels).sum().item()

print('æµ‹è¯•å‡†ç¡®ç‡: {:.4f}'.format(100.0*correct/total))

    """)

    button = st.button('è¿è¡Œ', key='MLP-mnist')
    if button:
        import torch
        import torch.nn as nn
        import torchvision  # torchä¸­ç”¨æ¥å¤„ç†å›¾åƒçš„åº“
        from torchvision import datasets, transforms
        import matplotlib.pyplot as plt
        # è®¾ç½®ä¸€äº›è¶…å‚
        num_epochs = 1  # è®­ç»ƒçš„å‘¨æœŸ
        batch_size = 100  # æ‰¹è®­ç»ƒçš„æ•°é‡
        learning_rate = 0.001  # å­¦ä¹ ç‡ï¼ˆ0.1,0.01,0.001ï¼‰

        # å¯¼å…¥è®­ç»ƒæ•°æ®
        train_dataset = datasets.MNIST(root='E:/MNIST/',  # æ•°æ®é›†ä¿å­˜è·¯å¾„
                                       train=True,  # æ˜¯å¦ä½œä¸ºè®­ç»ƒé›†
                                       transform=transforms.ToTensor(),  # æ•°æ®å¦‚ä½•å¤„ç†, å¯ä»¥è‡ªå·±è‡ªå®šä¹‰
                                       download=False)  # è·¯å¾„ä¸‹æ²¡æœ‰çš„è¯, å¯ä»¥ä¸‹è½½

        # å¯¼å…¥æµ‹è¯•æ•°æ®
        test_dataset = datasets.MNIST(root='E:/MNIST/',
                                      train=False,
                                      transform=transforms.ToTensor())
        train_loader = torch.utils.data.DataLoader(dataset=train_dataset,  # åˆ†æ‰¹
                                                   batch_size=batch_size,
                                                   shuffle=True)  # éšæœºåˆ†æ‰¹

        test_loader = torch.utils.data.DataLoader(dataset=test_dataset,
                                                  batch_size=batch_size,
                                                  shuffle=False)


        class MLP(nn.Module):  # ç»§æ‰¿nn.module
            def __init__(self):
                super(MLP, self).__init__()  # ç»§æ‰¿çš„ä½œç”¨

                self.layer1 = nn.Linear(784, 300)
                self.relu = nn.ReLU()
                self.layer2 = nn.Linear(300, 10)

                def forward(self, x):  # ç½‘ç»œä¼ æ’­çš„ç»“æ„
                    x = x.reshape(-1, 28 * 28)

                x = self.layer1(x)
                x = self.relu(x)
                y = self.layer2(x)
                return y


        loss_func = nn.CrossEntropyLoss()
        optimizer = torch.optim.Adam(mlp.parameters(), lr=learning_rate)

        for epoch in range(num_epochs):
            for i, (images, labels) in enumerate(train_loader):
                outputs = mlp(images)
                loss = loss_func(outputs, labels)
                optimizer.zero_grad()  # æ¸…é›¶æ¢¯åº¦
                loss.backward()  # åå‘æ±‚æ¢¯åº¦
                optimizer.step()

                if (i + 1) % 100 == 0:
                    print('Epoch [{}/{}], Loss: {:.4f}'.format(epoch + 1, num_epochs, loss.item()))

        # æµ‹è¯•æ¨¡å‹
        mlp.eval()  # æµ‹è¯•æ¨¡å¼ï¼Œå…³é—­æ­£åˆ™åŒ–
        correct = 0
        total = 0
        for images, labels in test_loader:
            outputs = mlp(images)
            _, predicted = torch.max(outputs, 1)  # è¿”å›å€¼å’Œç´¢å¼•
            total += labels.size(0)
            correct += (predicted == labels).sum().item()

        print('æµ‹è¯•å‡†ç¡®ç‡: {:.4f}'.format(100.0 * correct / total))


