import streamlit as st
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import statsmodels.formula.api as smf
import statsmodels.api as sm
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression

tab1, tab2 = st.tabs(['1.å·ç§¯', '2.æ± åŒ–'])

with tab1:
    """- å·ç§¯å®šä¹‰ï¼š"""
    r"""$ \qquad $ 1.å·ç§¯ï¼šæ•°å­¦ä¸Šå·ç§¯æ˜¯ä¸¤ä¸ªå®å˜å‡½æ•°çš„ä¸€ç§ç§¯åˆ†è¿ç®—ã€‚"""
    st.latex(r"""S(t)=\int{x(a)w(t-a)da}=(x*w)(t)""")
    r"""$ \qquad $ åœ¨ä¸Šå¼ä¸­wè¢«ç§°ä¸ºå·ç§¯æ ¸kernelï¼Œæˆ–è€…æ»¤æ³¢å™¨filterã€‚"""

    r"""$ \qquad $ 2.äº’ç›¸å…³ï¼šè¡¨ç¤ºä¸¤ä¸ªä¿¡å·çš„åœ¨ä»»æ„ä¸¤ä¸ªæ—¶åˆ»çš„ç›¸å…³ç¨‹åº¦ã€‚"""
    st.latex(r"""R(t)=\int{x(a)w(a+t)da}=(x*w)(t)""")

    r"""$ \qquad $ 3.äº’ç›¸å…³å’Œå·ç§¯å‡ ä¹ç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºå‰è€…ä¸ç”¨åšæ ¸ç¿»è½¬ã€‚æœºå™¨å­¦ä¹ çš„åº“ä¸­å®ç°çš„æ˜¯äº’ç›¸å…³å‡½æ•°ä½†å´ç§°ä¹‹ä¸ºå·ç§¯ã€‚"""

    """- ä¸€ç»´å·ç§¯ï¼š"""
    r"""$ \qquad $ 1.ä¸€ç»´å·ç§¯ç»å¸¸ç”¨åœ¨ä¿¡å·å¤„ç†ä¸­ç”¨äºè®¡ç®—ä¿¡å·çš„å»¶è¿Ÿç´¯ç§¯ã€‚"""
    r"""$ \qquad $ 2.å‡è®¾ä¸€ä¸ªä¿¡å·å‘ç”Ÿå™¨æ¯ä¸ªæ—¶åˆ»täº§ç”Ÿä¸€ä¸ªä¿¡å·$ğ‘¥_ğ‘¡$ï¼Œå…¶ä¿¡æ¯çš„è¡°å‡ç‡ä¸º$ğ‘¤_ğ‘˜$,å³åœ¨k-1ä¸ªæ—¶é—´æ­¥é•¿ä¹‹åä¿¡æ¯ä¸ºåŸæ¥çš„$ğ‘¤_ğ‘˜$å€ã€‚å‡è®¾ï¼Œ$ğ‘¤_1=1,ğ‘¤_2=\frac{1}{2},ğ‘¤_3=\frac{1}{4}$ï¼Œé‚£ä¹ˆåœ¨tæ—¶åˆ»æ”¶åˆ°çš„ä¿¡å·$ğ‘¦_ğ‘¡$å¯ä»¥è¡¨ç¤ºä¸ºï¼š
"""
    st.latex(r"""y_t=1\times{x_t}+\frac{1}{2}\times{x_{t-1}}+\frac{1}{4}\times{x_{t-2}}=\sum_{k=1}^3{w_kx_{t-k+1}}""")
    r"""$ \qquad $ ç§°$ğ‘¤_1,ğ‘¤_2,ğ‘¤_3$ä¸ºå·ç§¯æ ¸ï¼Œå‡è®¾å·ç§¯æ ¸çš„é•¿åº¦ä¸ºKï¼Œå®ƒå’Œä¸€ä¸ªä¿¡å·åºåˆ—$ğ‘¥_1,ğ‘¥_2,â€¦$çš„å·ç§¯è¡¨ç¤ºä¸º:"""
    st.latex(r"""y_t=\sum_{k=1}^K{w_kx_{t-k+1}}""")
    r"""$\qquad $ 3.ä¿¡å·åºåˆ—xå’Œæ»¤æ³¢å™¨wçš„å·ç§¯å®šä¹‰ä¸ºï¼š"""
    st.latex(r"""y=w*x""")
    r"""$\qquad $ (*è¡¨ç¤ºå·ç§¯è¿ç®—)"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡1.jpg', caption='å›¾1 ä¸€ç»´å·ç§¯ç¤ºä¾‹å›¾')
    r"""$ \qquad $ æ»¤æ³¢å™¨ä¸º[-1,0,1].ä¸€èˆ¬æƒ…å†µä¸‹æ»¤æ³¢å™¨çš„é•¿åº¦è¦è¿œè¿œå°äºä¿¡å·åºåˆ—çš„é•¿åº¦ã€‚"""
    """- äºŒç»´å·ç§¯"""
    r"""$ \qquad $ è¾“å…¥äºŒç»´å›¾åƒIï¼Œå·ç§¯æ ¸Kï¼ŒäºŒç»´ç¦»æ•£å·ç§¯ä¸ºï¼š"""
    st.latex(r"""S(i,j)=(I*K)(i,j)=\sum_{m,n}{I(m,n)K(i-m,j-n)}""")
    r"""$ \qquad $ å·ç§¯å…·æœ‰å¯äº¤æ¢æ€§ï¼š"""
    st.latex(r""" S(i,j)=(K*I)(i,j)""")
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡2.gif', caption='å›¾2 äºŒç»´å·ç§¯çš„è®¡ç®—è¿‡ç¨‹')
    st.latex(r""" å›¾2ä¸­å·ç§¯æ ¸ä¸ºï¼š \left( \begin{matrix}
   1 & 0 & 1 \\
   0 & 1 & 0 \\
   1 & 0 & 1
  \end{matrix} \right) 
$$
""")
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡3.png', caption='å›¾3 å·ç§¯å±‚çš„ä¸‰ç»´ç»“æ„è¡¨ç¤º')

    """- å·ç§¯çš„åŠ¨æœº"""
    r"""$ \qquad $ å·ç§¯è¿ç®—é€šè¿‡ä¸‰ä¸ªé‡è¦çš„æ€æƒ³æ¥å¸®åŠ©æ”¹è¿›æœºå™¨å­¦ä¹ ç³»ç»Ÿï¼š"""
    r"""$ \qquad \qquad $ ç¨€ç–äº¤äº’(sparse interactions)ã€å‚æ•°å…±äº«(parameter sharing)ã€ç­‰å˜è¡¨ç¤º(equivariant representations)ã€‚"""
    r"""$ \qquad $ 1.ç¨€ç–äº¤äº’ï¼šå·ç§¯ç½‘ç»œå…·æœ‰ç³»æ•°äº¤äº’ï¼ˆä¹Ÿå«åšç¨€ç–è¿æ¥æˆ–ç¨€ç–æƒé‡ï¼‰çš„ç‰¹å¾ã€‚è¿™æ˜¯ä½¿æ ¸çš„å¤§å°è¿œå°äºè¾“å…¥çš„å¤§å°æ¥è¾¾åˆ°çš„ã€‚"""
    _, col1, col2,_ = st.columns([1, 2, 2, 1])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡4.png', caption='å›¾4')
    with col2:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡5.png', caption='å›¾5')
    r"""$ \qquad $ 2.å‚æ•°å…±äº«"""
    r"""$ \qquad \qquad $ å‚æ•°å…±äº«æ˜¯æŒ‡åœ¨ä¸€ä¸ªæ¨¡å‹çš„å¤šä¸ªå‡½æ•°ä¸­ä½¿ç”¨ç›¸åŒçš„å‚æ•°ã€‚"""
    r"""$ \qquad \qquad $ å·ç§¯è¿ç®—ä¸­çš„å‚æ•°å…±äº«ä¿è¯äº†æˆ‘ä»¬åªéœ€è¦å­¦ä¹ ä¸€ä¸ªå‚æ•°é›†åˆï¼Œè€Œä¸æ˜¯å¯¹äºæ¯ä¸€ä½ç½®éƒ½éœ€è¦å­¦ä¹ ä¸€ä¸ªå•ç‹¬çš„å‚æ•°é›†åˆã€‚"""
    r"""$ \qquad \qquad $ è™½ç„¶æ²¡æœ‰æ”¹å˜å‰å‘ä¼ æ’­çš„è¿è¡Œæ—¶é—´ï¼ˆä»ç„¶æ˜¯ğ‘‚(ğ‘˜Ã—ğ‘›)ï¼‰ï¼Œä½†å®ƒç°ä½åœ°æŠŠæ¨¡å‹çš„å­˜å‚¨éœ€æ±‚é™ä½è‡³kä¸ªå‚æ•°ï¼Œå¹¶ä¸”ké€šå¸¸è¦æ¯”må°å¾ˆå¤šä¸ªæ•°é‡çº§ã€‚"""
    _, col1, _ = st.columns([1, 2, 1])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡6.png', caption='å›¾6 å‚æ•°å…±äº«')
    r"""$ \qquad $ è¾¹ç¼˜æå–çš„æ•ˆç‡ï¼š"""
    r"""$ \qquad \qquad $ ä¸‹å›¾è¯´æ˜äº†ç¨€ç–è¿æ¥+æ ¸å‚æ•°å…±äº«æ˜¯å¦‚ä½•æ˜¾è‘—æé«˜çº¿æ€§å‡½æ•°åœ¨ä¸€å¼ å›¾åƒä¸Šè¿›è¡Œè¾¹ç¼˜æ£€æµ‹çš„æ•ˆç‡çš„ã€‚ """
    _, col1, _ = st.columns([1, 2, 1])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡7.png', caption='å›¾7')

    r"""$ \qquad $ 3.ç­‰å˜è¡¨ç¤º"""
    r"""$ \qquad \qquad $ å¦‚æœä¸€ä¸ªå‡½æ•°æ»¡è¶³è¾“å…¥æ”¹å˜ï¼Œè¾“å‡ºä¹Ÿä»¥åŒæ ·çš„æ–¹å¼æ”¹å˜è¿™ä¸€æ€§è´¨ï¼Œæˆ‘ä»¬å°±è¯´å®ƒæ˜¯ç­‰å˜çš„ã€‚ç‰¹åˆ«çš„æ˜¯ï¼Œå¦‚æœå‡½æ•°$ğ‘“(ğ‘¥)$ä¸$ğ‘”(ğ‘¥)$æ»¡è¶³$ğ‘“(ğ‘”(ğ‘¥))=ğ‘”(ğ‘“(ğ‘¥))$ï¼Œæˆ‘ä»¬å°±è¯´$ğ‘“(ğ‘¥)$å¯¹äºå˜æ¢gå…·æœ‰ç­‰å˜æ€§ã€‚"""
    r"""$ \qquad \qquad $ å¯¹äºå·ç§¯ï¼Œå‚æ•°å…±äº«çš„ç‰¹æ®Šå½¢å¼ä½¿å¾—ç¥ç»ç½‘ç»œå…·æœ‰å¯¹å¹³ç§»ç­‰å˜(equivariance)çš„æ€§è´¨ã€‚"""
    r"""$ \qquad \qquad $ å·ç§¯æ“ä½œå¯¹å›¾ç‰‡çš„æ—‹è½¬æˆ–è€…ç¼©æ”¾ä¸æ˜¯ç­‰å˜çš„ã€‚"""

    """- å¡«å……å’Œæ­¥é•¿"""
    r"""$ \qquad $ 1.å¡«å……(padding)ï¼šå¯¹å›¾åƒè¾¹ç¼˜è¿›è¡Œå¡«å……çš„æ“ä½œã€‚"""
    r"""$ \qquad $ 2.æ­¥é•¿(stride)ï¼šè·³è¿‡æ ¸ä¸­çš„ä¸€äº›ä½ç½®ï¼Œé™ä½è®¡ç®—å¼€é”€ï¼Œå¯ä»¥çœ‹åšæ˜¯å¯¹å…¨å·ç§¯æ“ä½œçš„ä¸‹é‡‡æ ·ã€‚"""
    r"""$ \qquad $ 3.å¡«å……çš„å‡ ç§æ–¹å¼ï¼š0å¡«å……ã€å¤åˆ¶å¡«å……ã€å¯¹ç§°å¡«å……ã€‚"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡8.png', caption='å›¾8')
    _, col1, col2, col3 = st.columns([0.5, 2.7, 1.5, 1.7])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡9.gif', caption='å›¾9 padding:(0,0),stride:(1,1)')
    with col2:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡10.gif', caption='å›¾10 padding:(2,2),stride:(1,1)')
    with col3:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡11.gif', caption='å›¾11 padding:(0,0),stride:(2,2)')
    """- å·ç§¯çš„å˜ç§ï¼š"""
    r"""$ \qquad $ 1. å¸¸è§„å·ç§¯"""
    r"""$ \qquad $ 2. ç©ºæ´å·ç§¯"""
    r"""$ \qquad $ 3. åˆ†ç»„å·ç§¯"""
    r"""$ \qquad $ 4. åå·ç§¯"""
    r"""$ \qquad $ 5. å›¾å·ç§¯"""
    r"""$ \qquad $ 6. éƒ¨åˆ†å·ç§¯ã€å¯å˜æ€§å·ç§¯ã€å› æœå·ç§¯ç­‰ç­‰...."""

with tab2:
    """- å®šä¹‰ï¼šæ± åŒ–(Pooling)ä½¿ç”¨æŸä¸€ä½ç½®çš„ç›¸é‚»è¾“å‡ºçš„æ€»ä½“ç»Ÿè®¡ç‰¹å¾æ¥ä»£æ›¿ç½‘ç»œåœ¨è¯¥ä½ç½®çš„è¾“å‡ºã€‚"""
    """- æ± åŒ–çš„å‡ ç§æ–¹å¼ï¼š"""
    r"""$ \qquad $ 1. æœ€å¤§æ± åŒ–(Max pooling)"""
    r"""$ \qquad $ 2. å¹³å‡æ± åŒ–(Averag pooling)"""
    r"""$ \qquad $ 3. å…¶å®ƒå¦‚$ğ¿^2$èŒƒæ•°ä»¥åŠåŸºäºè·ä¸­å¿ƒåƒç´ è·ç¦»çš„åŠ æƒå¹³å‡å‡½æ•°ç­‰ã€‚"""
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡12.jpg', caption='å›¾12 æ± åŒ–çš„è®¡ç®—è¿‡ç¨‹')
    """- æ± åŒ–çš„ä½œç”¨ï¼š"""
    r"""$ \qquad $ 1. æ— é™å¼ºå…ˆéªŒï¼šä¸ç®¡é‡‡ç”¨ä»€ä¹ˆæ ·çš„æ± åŒ–å‡½æ•°ï¼Œå½“è¾“å…¥ä½œå‡ºå°‘é‡å¹³ç§»æ—¶ï¼Œæ± åŒ–èƒ½å¤Ÿå¸®åŠ©è¾“å…¥çš„è¡¨ç¤ºè¿‘ä¼¼ä¸å˜ï¼ˆinvariantï¼‰ã€‚å±€éƒ¨å¹³ç§»ä¸å˜æ€§æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„æ€§è´¨ï¼Œå°¤å…¶æ˜¯å½“æˆ‘ä»¬å…³å¿ƒæŸä¸ªç‰¹å¾æ˜¯å¦å‡ºç°è€Œä¸å…³å¿ƒå®ƒå‡ºç°çš„å…·ä½“ä½ç½®æ—¶ã€‚"""
    r"""$ \qquad $ 2.æå¤§åœ°æé«˜è®¡ç®—æ•ˆç‡ï¼Œä¸‹ä¸€å±‚çš„è¾“å…¥å°‘äº†å¤§çº¦kå€ã€‚"""
    r"""$ \qquad $ 3.å‡å°‘äº†å‚æ•°å­˜å‚¨éœ€æ±‚ã€‚"""
    r"""$ \qquad $ 4.å­¦ä¹ ä¸å˜å½¢ã€‚"""
    r"""$ \qquad \qquad $ å¯¹ç©ºé—´åŒºåŸŸè¿›è¡Œæ± åŒ–äº§ç”Ÿäº†å¹³ç§»ä¸å˜æ€§ï¼Œä½†å½“æˆ‘ä»¬å¯¹åˆ†ç¦»å‚æ•°çš„å·ç§¯çš„è¾“å‡ºè¿›è¡Œæ± åŒ–æ—¶ï¼Œç‰¹å¾èƒ½å¤Ÿå­¦å¾—åº”è¯¥å¯¹äºå“ªç§å˜æ¢å…·æœ‰ä¸å˜æ€§ã€‚å¦‚ä¸‹å›¾ï¼š """
    _, col1, _ = st.columns([1, 4, 1])
    with col1:
        st.image('./chapter3_CNN/pages/å›¾ç‰‡/å›¾ç‰‡13.png', caption='å›¾13')